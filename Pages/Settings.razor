
@page "/settings"
@inject NavigationManager navigationManager
@using Microsoft.AspNetCore.SignalR.Client;
@using SmartSwitchWeb.Data
@using SmartSwitchWeb.Hubs
@using SmartSwitchWeb.Services
@using Ical.Net.DataTypes;





<h3>Settings</h3>

<button class="btn btn-primary" @onclick="Send">Click me</button>
<form method="post">
    <div>
        <label>
            <span>
            "Frühste Startzeit":
            </span>
            <input type="datetime-local" name="startDate" required/>
        </label>
    </div>
    <div>
    <label>
        <span>
        "Fertig bis":
        </span>
        <input type="datetime-local" name="endDate" required/>
    </label>
    </div>
    <div>
    <label>
        <span>
        "Dauer in Min":
        </span>
        <input type="time" name="duration" required/>
    </label>
    </div>
    <div>
    <label>
        <span>
        "Benötigte MW":
        </span>
        <input type="number" name="mw" required />
    </label>
    </div>
    <input type="checkbox" name="test" id="name" @onchange=toggleScheduler class="form-check-input"/>
    <input type="submit" onclick="Send" />
    <div hidden="@schedulerHidden">
        <ul>
            @foreach (var occurrence in occurences)
            {
                <li>
                    @occurrence.Period.StartTime
                </li>
            }
       </ul>
    </div>
</form>


@code {
    private DateTimeOffset _startTime;
    private DateTimeOffset _endTime;
    private int _durationMin;
    private int _mw;
    private bool _isOnline;
    private bool toggle { get; set; }
    bool schedulerHidden = true;
    private HashSet<Occurrence> occurences = IcalCalendar.addDailyEvent();

    private string _hubUrl;
    private HubConnection _hubConnection;
    protected  async override  Task OnInitializedAsync()
    {
        try
        {
            _isOnline = true;
            string baseUrl = navigationManager.BaseUri;

            _hubUrl = baseUrl.TrimEnd('/') + FrontEndHub.HubUrl;
            _hubConnection = new HubConnectionBuilder()
                .WithUrl(_hubUrl)
                .Build();

            await _hubConnection.StartAsync();
        }
        catch (Exception e)
        {
            //_message = $"ERROR: Failed to start chat client: {e.Message}";
            //_isChatting = false;
        }

    }
    private async Task Send()
    {
        await _hubConnection.SendAsync("TestMessage", toggle);
    }
    //toggle scheduler div
    private void toggleScheduler() => schedulerHidden = !schedulerHidden;

    private int currentCount = 0;
    public void IncrementCount()
    {
        currentCount++;   

    }
    public void OnPost()
    {
        
    }
}
